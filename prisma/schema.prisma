generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x", "windows"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model appointment {
  appointment_id Int                 @id @default(autoincrement())
  reason         String?
  price          Decimal             @default(200) @db.Decimal(10, 2)
  status         appointment_status
  result         appointment_result?
  med_notes      String?
  created_at     DateTime            @default(now())
  updated_at     DateTime            @updatedAt
  pet_id         Int
  slot_id        Int                 @unique
  pet            pet                 @relation(fields: [pet_id], references: [pet_id], onDelete: NoAction, onUpdate: NoAction)
  slot           slot                @relation(fields: [slot_id], references: [slot_id], onDelete: NoAction, onUpdate: NoAction)
  diagnosis      diagnosis[]

  @@index([pet_id, created_at])
  @@index([status])
}

model breed {
  breed_id   Int      @id @default(autoincrement())
  name       String   @default("unpedigreed") @db.VarChar(50)
  species_id Int
  species    species  @relation(fields: [species_id], references: [species_id], onDelete: NoAction, onUpdate: NoAction)
  pet        pet[]

  @@unique([species_id, name])
}

model user {
  user_id     Int       @id @default(autoincrement())
  email       String    @unique @db.VarChar(50) 
  phone       String?   @unique @db.VarChar(32)
  name        String    @db.VarChar(50)
  surname     String    @db.VarChar(50)
  password    String 
  role        role
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  is_deleted  Boolean   @default(false)
  owner       owner?
  vet         vet?
}

model diagnosis {
  diagnosis_id   Int         @id @default(autoincrement())
  illness        String      @db.VarChar(100)
  description    String
  is_active      Boolean
  created_at     DateTime    @default(now())
  updated_at     DateTime    @updatedAt
  appointment_id Int
  appointment    appointment @relation(fields: [appointment_id], references: [appointment_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([appointment_id, illness])
}

model owner {
  user_id         Int          @id @unique
  user            user         @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  pet             pet[]
}

model pet {
  pet_id        Int           @id @default(autoincrement())
  name          String        @db.VarChar(50)
  date_of_birth DateTime      @db.Date
  gender        gender_type
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
  is_deleted    Boolean       @default(false)
  breed_id      Int
  owner_user_id Int           
  breed         breed         @relation(fields: [breed_id], references: [breed_id], onDelete: NoAction, onUpdate: NoAction)
  owner         owner         @relation(fields: [owner_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  appointment   appointment[]

  @@index([breed_id])
  @@index([owner_user_id, is_deleted])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model schedule_template {
  template_id   Int          @id @default(autoincrement())
  day_of_week   days_of_week
  start_time    DateTime     @db.Time(0)
  end_time      DateTime     @db.Time(0)
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt
  slot_duration Int          @db.SmallInt
  vet_user_id   Int
  vet           vet          @relation(fields: [vet_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  slot          slot[]

  @@unique([vet_user_id, day_of_week])
}

model slot {
  slot_id            Int                @id @default(autoincrement())
  date               DateTime           @db.Date
  start_time         DateTime           @db.Time(0)
  created_at         DateTime           @default(now())
  updated_at         DateTime           @updatedAt
  vet_user_id        Int
  template_id        Int
  vet                vet                @relation(fields: [vet_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  schedule_template  schedule_template  @relation(fields: [template_id], references: [template_id], onDelete: NoAction, onUpdate: NoAction)
  appointment appointment?


  @@unique([vet_user_id, date, start_time])
  @@index([vet_user_id, date])
  @@index([vet_user_id])
}

model species {
  species_id Int       @id @default(autoincrement())
  name       String    @unique @db.VarChar(50)
  breed      breed[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model vet {
  user_id           Int                 @id @unique
  user              user                @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  updated_at        DateTime            @default(now()) @updatedAt
  experience        Int?                @db.SmallInt
  specialisation    String              @db.VarChar(32)
  is_active         Boolean
  schedule_template schedule_template[]
  slot              slot[]
}

enum appointment_result {
  healthy
  diagnosed
  recovered
}

enum appointment_status {
  scheduled
  in_progress @map("in progress")
  completed
}

enum days_of_week {
  monday
  tuesday
  wednesday
  thursday
  friday
  saturday
  sunday
}

enum gender_type {
  male
  female
}

enum role {
  owner
  vet
  admin
}