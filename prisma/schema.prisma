generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x", "windows"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model appointment {
  appointment_id Int                 @id @default(autoincrement())
  reason         String?
  price          Decimal             @default(200) @db.Decimal(10, 2)
  status         appointment_status
  result         appointment_result?
  med_notes      String?
  pet_id         Int
  slot_id        Int                 @unique
  pet            pet                 @relation(fields: [pet_id], references: [pet_id], onDelete: NoAction, onUpdate: NoAction)
  slot           slot                @relation(fields: [slot_id], references: [slot_id], onDelete: NoAction, onUpdate: NoAction)
  diagnosis      diagnosis[]
}

model breed {
  breed_id   Int     @id @default(autoincrement())
  name       String  @default("unpedigreed") @db.VarChar(32)
  species_id Int
  species    species @relation(fields: [species_id], references: [species_id], onDelete: NoAction, onUpdate: NoAction)
  pet        pet[]

  @@unique([species_id, name])
}

model user {
  user_id   Int      @id @default(autoincrement())
  email     String   @unique @db.VarChar(50) 
  phone     String?  @unique @db.VarChar(50)
  name      String   @db.VarChar(32)
  surname   String   @db.VarChar(32)
  password  String 
  role      role
  owner     owner?
  vet       vet?
}

model diagnosis {
  diagnosis_id   Int         @id @default(autoincrement())
  illness        String      @db.VarChar(32)
  description    String
  is_active      Boolean
  appointment_id Int
  appointment    appointment @relation(fields: [appointment_id], references: [appointment_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([appointment_id, illness])
}

model owner {
  user_id         Int          @id @unique
  user            user         @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  pet             pet[]
}

model pet {
  pet_id        Int           @id @default(autoincrement())
  name          String        @db.VarChar(32)
  date_of_birth DateTime      @db.Date
  gender        gender_type
  breed_id      Int
  owner_user_id Int           
  breed         breed         @relation(fields: [breed_id], references: [breed_id], onDelete: NoAction, onUpdate: NoAction)
  owner         owner         @relation(fields: [owner_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  appointment   appointment[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model schedule_template {
  template_id   Int          @id @default(autoincrement())
  day_of_week   days_of_week
  start_time    DateTime     @db.Time(6)
  end_time      DateTime     @db.Time(6)
  slot_duration Int          @db.SmallInt
  vet_user_id   Int
  vet           vet          @relation(fields: [vet_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([vet_user_id, day_of_week])
}

model slot {
  slot_id     Int          @id @default(autoincrement())
  date        DateTime     @db.Date
  start_time  DateTime     @db.Time(6)
  vet_user_id Int
  appointment appointment?
  vet         vet          @relation(fields: [vet_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([vet_user_id, date, start_time])
}

model species {
  species_id Int     @id @default(autoincrement())
  name       String  @unique @db.VarChar(32)
  breed      breed[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model vet {
  user_id           Int                 @id @unique
  user              user                @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  experience        Int                 @db.SmallInt
  specialisation    String              @db.VarChar(32)
  is_active         Boolean
  schedule_template schedule_template[]
  slot              slot[]
}

enum appointment_result {
  healthy
  diagnosed
  recovered
}

enum appointment_status {
  scheduled
  in_progress @map("in progress")
  completed
}

enum days_of_week {
  monday
  tuesday
  wednesday
  thursday
  friday
  saturday
  sunday
}

enum gender_type {
  male
  female
}

enum role {
  owner
  vet
  admin
}