# Vet Clinic - Course Backend + DB Project

---

## Опис проєкту

---

Проєкт побудований на основі системи ветеринарної клініки з функціями створення прийомів з урахуванням власників, ветеринарів, домашніх улюбленців, розкладів ветеринарів і діагнозів прийомів.

Автори: Олексійчук Станіслав ІМ-43, Хубеджева Єлизавета ІМ-43

---

## Технологічний стек

- **Мова програмування:** Node.js 20
- **ORM:** Prisma 5.22.0
- **СУБД:** PostgreSQL 15
- **Framework:** Express 5.2.1
- **Автентифікація:** JWT (jsonwebtoken 9.0.3)
- **Тестування:** Jest 30.2.0 + Supertest 7.1.4
- **Контейнеризація:** Docker + Docker Compose

---

## Схема бази даних

---

Система включає 10 таблиць (сутностей), серед яких:

- **user** - користувачі системи;
- **owner** - власники тварин (основні користувачі системи);
- **vet** - ветеринарі (користувачі системи, створені адміністратором);
- **species** - види тварин;
- **breed** - породи тварин;
- **pet** - домашній улюбленець власників;
- **schedule_template** - шаблон розкладу ветеринарів;
- **slot** - слоти запису на прийоми, створені за шаблоном розкладу ветеринара;
- **appointment** - прийом;
- **diagnosis** - діагнози на прийоми.

Для кращого розуміння схеми бази даних, сутностей та їх зв'язків, цей розділ було розширено в [docs/schema.md](D:\KPI_Tasks\VetClinic_CW\docs\schema.md).

---

## Інструкції з налаштування (запуск додатку)

---

Для запуску проєкту потрібно:

#### Крок 1: Пререквізити

Потрібно перевірити, чи встановлено:

- **Docker Desktop** & **Docker Compose**
- **Git**
- **Node.js 20+**

#### Крок 2: Клонування репозиторію

Склонуйте репозиторій у зручне місце в локальному середовищі:

```
git clone https://github.com/Liza-Khube/VetClinic_CW.git
```

#### Крок 3: Зайдіть у папку репозиторію

```shell
cd VetClinic_CW
```

#### Крок 4: Налаштуйте середовище проєкту

1. Створіть файл `.env` в корені проєкту.

2) Додайте цей код до вмісту .env:

```
JWT_SECRET="our_jwt_secret_vet_key"
POSTGRES_USER=postgres
POSTGRES_PASSWORD=Vet1234_db
POSTGRES_DB=vet_clinic
PORT=3000

DATABASE_URL="postgresql://postgres:Vet1234_db@localhost:5432/vet_clinic?schema=public"
```

Примітки:

- у `JWT_SECRET` можна написати будь-яке інше значення (бажано складніше).

#### Крок 4: Запуск проєкту через Docker

Основний варіант запуску проєкту. Для цього запустіть цю команду:

```
docker compose up --build -d # Ця команда створить контейнери та запустить проєкт з доступом до терміналу
```

Якщо хочете водночас бачити зміни в базі даних, можна додати її локально, спостерігаючи зміни через pgAdmin:

- Завантажте pgAdmin
- Зареєструйте новий сервер
- У розділі "Connections" підключіть базу даних, використовуючи ті самі параметри, що в `.env` файлі

#### Крок 5 (не обов'язковий): Локальний запуск проєкту

Можна запускати проєкт локально, проте бажано використовувати контейнер Docker для бази даних db
Ось послідовні команди для запуску:

```
docker compose up -d db    # Запуск БД у фоні
npm install                # Встановлення залежностей
npx prisma migrate dev     # Створення таблиць
npx prisma generate        # Генерація клієнта
npx prisma db seed         # Створення адміністратора
npm run dev                # Запуск сервера
```

---

## Запуск тестів

---

Для запуску всіх тестів потрібно виконати команду:

```
npm run test
```

Для запуску конкретного тесту потрібно вказати його шлях:

```
npm test -- test/${name_of_the_file}.test.js
```

---

## Структура проєкту

---

```
VetClinic_CW/
├── docs/
│   ├── schema.md      	      # Опис схеми бази даних
│   └── queries.md            # Опис складних запитів до бази даних
│
├── prisma/
│   ├── migrations/    # Міграції бази даних
│   ├── schema.prisma  # Схема в Prisma
│   └── seed.js        # Скрипт для тестових даних (створення адміністратора)
│
├── src/
│   ├── controllers/                # HTTP контроллери
│   │   ├── petController.js
│   │   ├── scheduleController.js
│   │   └── userController.js
│   │
│   ├── middleware/                 # Проміжний шар логіки для валідації
│   │   ├── auth.js
│   │   └── errorHandler.js
│   │
│   ├── repositories/               # Доступ до бази даних
│   │   ├── breedRepository.js
│   │   ├── petRepository.js
│   │   ├── scheduleRepository.js
│   │   ├── speciesRepository.js
│   │   └── userRepository.js
│   │
│   ├── routes/                     # Шляхи з ендпоінтами
│   │   ├── ownerRoutes.js
│   │   ├── petRoutes.js
│   │   ├── scheduleRoutes.js
│   │   └── userRoutes.js
│   │
│   ├── services/                   # Бізнес логіка з допоміжними функціями та валідацією
│   │   ├── breedService.js
│   │   ├── petService.js
│   │   ├── scheduleService.js
│   │   ├── speciesService.js
│   │   └── userService.js
│   │
│   ├── app.js           # Додаток
│   ├── prismaClient.js  # Prisma client
│   └── server.js        # HTTP сервер
│
├── test/                        # Тести під основні сценарії реалізації проєкту
│   ├── pet.test.js
│   ├── schedule.test.js
│   └── user.test.js
│
├── utils/                       # Утиліти, додаткові функції для реалізації та кращого вигляду запитів
│   └── dateUtils.js
│
├── CONTRIBUTIONS.md             # Опис внеску кожного з учасників у реалізацію проєкту
├── docker-compose.yml           # Конфігурація проєкту для Docker
├── Dockerfile                   # Docker інструкції
├── package-lock.json            # Основні скрипти та залежності інстальованих технологій
├── package.json                 # Основні скрипти та залежності
└── README.md                    # Опис проєкту
```

---

## API Endpoints

#### Authentication: userRoutes `(/api/users)`

| Метод | Endpoint                     | Призначення                                                                                                                             | Чи потрібно<br />авторизуватися |  Кому дозволено   |
| :---: | ---------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------- | :-----------------------------: | :---------------: |
| POST  | `/register`                  | Реєстрація власників тварин                                                                                                             |               ❌                |         -         |
| POST  | `/login`                     | Вхід в обліковий запис для всіх користувачів                                                                                            |               ❌                | owner, vet, admin |
| POST  | `/create-vet`                | Створення користувача-ветеринара                                                                                                        |               ✅                |       admin       |
|  GET  | `/vets`                      | Отримання списку ветеринарів,<br />відфільтрованих (опціонально) за мінімальним досвідом, <br />активністю і пагінацією (limit, offset) |               ❌                | owner, vet, admin |
|  GET  | `/owners`                    | Отримання списку власників тварин, відфільтрованих<br />за пагінацією (limit, offset)                                                   |               ✅                |       admin       |
| PATCH | `/vets/:vetUserId/is-active` | Оновлення активності ветеринара у вигляді перемикача                                                                                    |               ✅                |       admin       |

---

#### Schedule and slots: scheduleRoutes `(/api)`

| Метод | Endpoint                          | Призначення                                                                                                                                                                                   | Чи потрібно<br />авторизуватися |             Кому дозволено              |
| :---: | --------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----------------------------: | :-------------------------------------: |
| POST  | `/vets/:vetUserId/schedule`       | Створення розкладу та слотів на вказану кількість днів                                                                                                                                        |               ✅                | admin (за можливим<br />проханням vetа) |
| POST  | `/vets/:vetUserId/schedule/slots` | Додавання слотів до вже існуючого<br />розкладу та, можливо, інших слотів                                                                                                                     |               ✅                | admin (за можливим<br />проханням vetа) |
|  GET  | `/vets/:vetUserId/schedule`       | Отримання розкладу ветеринара за параметром з його id<br />та (опціально) фільтрацією з query-параметрів за вказаним <br />днем тижня                                                         |               ❌                |            owner, vet, admin            |
|  GET  | `/vets/:vetUserId/schedule/slots` | Отримання списку слотів ветеринара,<br />відфільтрованих (опціонально) за датою і пагінацією (limit, offset)                                                                                  |               ❌                |            owner, vet, admin            |
|  GET  | `/vets/schedule/analytics`        | Складний запит на отримання звіту<br />про рейтинг виділення годин/слотів <br />на ветеринарів з фільтрацією за місяцем, <br />роком і мінімальною кількістю виділених слотів<br /> на лікаря |               ✅                |                  admin                  |

---

#### Owner's pets: ownerRoutes `(/api/owner)`

| Метод | Endpoint          | Призначення                                          | Чи потрібно<br />авторизуватися | Кому дозволено |
| :---: | ----------------- | :--------------------------------------------------- | :-----------------------------: | :------------: |
| POST  | `/create-pet`     | Створення профілю (додавання) тварини власником собі |               ✅                |     owner      |
|  PUT  | `/update-pet/:id` | Оновлення даних домашнього улюбленця власника        |               ✅                |     owner      |
|  GET  | `/my-pets`        | Отримання даних всіх домашніх улюбленців власника    |               ✅                |     owner      |

---

#### Pets: petRoutes `(/api/pets)`

| Метод | Endpoint            | Призначення                                   | Чи потрібно<br />авторизуватися | Кому дозволено |
| :---: | ------------------- | :-------------------------------------------- | :-----------------------------: | :------------: |
|  GET  | `/all-pets`         | Отримання даних усіх домашніх улюбленців      |               ✅                |     admin      |
|  GET  | `/owners-with-pets` | Оновлення даних домашнього улюбленця власника |               ✅                |     admin      |
